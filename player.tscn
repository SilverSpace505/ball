[gd_scene load_steps=6 format=3 uid="uid://xf7dekaj2vlt"]

[ext_resource type="Script" uid="uid://dksggyfqmwiyv" path="res://player.gd" id="1_4flbx"]

[sub_resource type="SphereShape3D" id="SphereShape3D_4flbx"]
radius = 1.0

[sub_resource type="Shader" id="Shader_4flbx"]
code = "shader_type spatial;

varying vec3 pos;
uniform int shade_bands : hint_range(2, 10) = 3;

uniform vec4 rim_color : source_color = vec4(1.0, 1.0, 1.0, 1.0);
uniform float rim_threshold : hint_range(0.0, 1.0) = 0.5;
uniform float rim_smoothness : hint_range(0.0, 0.1) = 0.01;

void vertex() {
	pos = (VERTEX + 1.0) / 2.0;
}

void fragment() {
	ALBEDO = vec3(0.0, clamp(pos.x + 0.25, 0.5, 1.0), clamp((pos.z + pos.x) / 2.0 + 0.5, 0.75, 1.0)) / 2.0;
	float NdotV = dot(NORMAL, VIEW);
	float rim = 1.0 - NdotV;
	rim = smoothstep(
		rim_threshold - rim_smoothness,
		rim_threshold + rim_smoothness,
		rim
	);
	ALBEDO = (1.0 - rim) * ALBEDO + (vec3(0.5) + ALBEDO) * 1.0;
}

void light() {
	float NdotL = dot(NORMAL, LIGHT);
	
	float stepped_diffuse = floor(NdotL * float(shade_bands)) / float(shade_bands);
	stepped_diffuse = max(0.0, stepped_diffuse);
    DIFFUSE_LIGHT += ALBEDO * LIGHT_COLOR * ATTENUATION * stepped_diffuse;
	
	float NdotV = dot(NORMAL, VIEW);
	float rim = 1.0 - NdotV;
	rim = smoothstep(
		rim_threshold - rim_smoothness,
		rim_threshold + rim_smoothness,
		rim
	);
	DIFFUSE_LIGHT = rim_color.rgb * rim * ATTENUATION;
}

//void light() {
//	// Called for every pixel for every light affecting the material.
//	// Uncomment to replace the default light processing function with this one.
//}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_onrkg"]
render_priority = 0
shader = SubResource("Shader_4flbx")
shader_parameter/shade_bands = 3
shader_parameter/rim_color = Color(1, 1, 1, 1)
shader_parameter/rim_threshold = 0.6000000285
shader_parameter/rim_smoothness = 0.0450000021375

[sub_resource type="SphereMesh" id="SphereMesh_onrkg"]
material = SubResource("ShaderMaterial_onrkg")
uv2_padding = 4.84
radius = 1.0
height = 2.0

[node name="player" type="CharacterBody3D" node_paths=PackedStringArray("username", "mesh", "core")]
physics_interpolation_mode = 1
transform = Transform3D(0.075, 0, 0, 0, 0.075, 0, 0, 0, 0.075, 0, 0, 0)
script = ExtResource("1_4flbx")
username = NodePath("core/Label3D")
mesh = NodePath("core/MeshInstance3D")
core = NodePath("core")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_4flbx")

[node name="core" type="Node3D" parent="."]
transform = Transform3D(0.075, 0, 0, 0, 0.075, 0, 0, 0, 0.075, 0, 0, 0)
top_level = true

[node name="MeshInstance3D" type="MeshInstance3D" parent="core"]
transform = Transform3D(-4.371139e-08, 0, 1, 0, 1, 0, -1, 0, -4.371139e-08, 0, 0, 0)
mesh = SubResource("SphereMesh_onrkg")
skeleton = NodePath("../..")

[node name="Label3D" type="Label3D" parent="core"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.3718, 0)
billboard = 1
no_depth_test = true
fixed_size = true
font_size = 64
